# Initializing, Applying and Destroying Infrastructure using Terraform

This tutorial will explain how to use the configuration file `main.tf` created in the previous tutorial to deploy and manage infrastructure using Terraform. We will now look at how to initialize Terraform, apply the configuration to create the specified resources, verify that everything is working as expected, and finally clean up by destroying the deployed infrastructure.

## Init

To verify that `main.tf` was correctly parsed by Terraform, one can execute the command:

```
terraform init
```

Here Terraform checks that the installation is OK and that the commands are working as expected.


## Applying the Changes

In Terraform, applying the changes means that the specified resources will be used. In our case, since we specified Docker containers, this means that these containers will be launched and configured in the way we specified in the configuration file `main.tf`. Run the command:
```
sudo terraform apply
```

The program should tell you everything looks ok and what it plans to do when you apply the changes. If not, please go back to the previous tutorial and double check that the `main.tf` file is correctly configured. 

The CLI will now ask if the planned changes are to action to be performed. Type `yes` and hit `enter` and Terraform will deploy your configuration. 

Now the Docker containers are up and running!

## Verifying Everything Works

We need to check that the Docker network is working as expected as it is crucial that the containers communicate with each other. To do this, simply inspect the network by running the command: 

```
sudo docker network inspect container_network
```
In the output, look for a tag named `containers` and in this tag you should see both `snort` and `http` containers and their allocated IP addresses. If the tag is empty, something was done incorrectly and please go back and verify that it was done correctly.


Of course, we want to use the software inside the containers. As Snort is an Intrusion Detection Tool, we need to trigger it somehow. Let's do this by intentionally triggering the pre-installed `ping alert rule`:

```
sudo docker exec snort ping -c 3 8.8.8.8
```

Hopefully, this triggered the rule but we wont see any output yet. To see the output, Snort serves its alerts to the http server! Let's see if we have any alerts saved on the http-server by grabbing the logs of the `http-server` docker container.

```
sudo docker logs http-server
```

The output should contain information about the ping generated by the Snort container!

## Destroying the Deployed Infrastructure
Now that we're at the end of this tutorial, we need to clean up our environment by shutting down all containers and networks as leaving them up could present a security issue. To do this execute the command:

```
terraform destroy
```
and when prompted, type `yes` and hit `enter`. 

Terraform will now undeploy the infrastructure and clean up the system. Of course, one can simply redeploy the entire infrastructure again by running `terraform apply`. **This is the power of Infrastructure as Code!**

## What We Have Done
- We have initialized Terraform to verify that the configuration file was correctly parsed
- We have applied the configuration file to deploy the specified resources
- We have verified that the resources are working as expected
- We have destroyed the deployed resources to clean up the system