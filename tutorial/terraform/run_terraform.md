# Initializing, Applying and Destroying Infrastructure using Terraform

Now that the configuration file for terraform (main.tf) has been configured, the last step is to use it. Please 

## Init

To verify that `main.tf` was correctly parsed by Terraform, one can execute the command:

```
terraform init
```

Here Terraforms checks that the installation is OK and that the commands are working as expected.


## Applying the Changes

In terraform, applying the changes means that the specified resources will be used. In our case, since we specified docker containers, this means that these containers will be launched and configured in the way we specified in the configuration file `main.tf`.

The program should tell you everything looks ok and what it plans to do when you apply the changes. If not, please go back and double check that the `main.tf` file is correctly configured. 

The CLI will now ask if the planned changes are to action to be performed. Type `yes` and Terraform will deploy your configuration. 

Now the docker containers are up and running!

## Verifying Everything Works

We need to check that the docker network is working as expected as it is crucial that the containers communicate with each other. To do this, simply inspect the network by running the command: 

```
sudo docker network inspect container_network
```
In the output, look for a tag named `containers` and in this tag you should see both `snort` and `http` containers and their allocated IP addresses. If the tag is empty, something was done incorrectly and please go back and verify that it was done correctly.


Of course, we want to use the software inside the containers. As Snort is an Intrusion Detection Tool, we need to trigger it somehow. Let's do this by intentionally triggering the pre-installed `ping alert rule`:

```
sudo docker exec snort ping 8.8.8.8
```

Hopefully, this triggered the rule but we wont see any output yet. To see the output, snort pushes its alerts to the http server! Let's see if we have any alerts saved on the http-server by grabbing the logs of the `http` docker container.


```
sudo docker logs http-server
```

The output should contain information about the ping generated by the Snort container!


## Destroying the Deployed Infrastructure
Now that we're at the end of this tutorial, we need to clean up our environment by shutting down all containers and networks as leaving them up could present a security issue. To do this execute the command:

```
terraform destroy
```

Terraform will now undeploy the infrastructure and clean up the system. Of course, one can simply redeploy the entire infrastructure again by running `terraform apply`. 


## What We Have Done
This part of the tutorial verified that the configuration file `main.tf` was correctly configured and had terraform apply the intended resources to the system.